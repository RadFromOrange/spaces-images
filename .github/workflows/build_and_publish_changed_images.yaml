name: Build & publish changed images

on:
  push:
    branches:
    - main

jobs:

  detect_image_source_changes:
    runs-on: ubuntu-latest
    outputs:
      eclipse_changed: ${{ steps.changes_to_eclipse.outputs.any_changed == 'true' || steps.changes_to_eclipse.outputs.any_deleted == 'true' }}
      nodejs_12_changed: ${{ steps.changes_to_nodejs_12.outputs.any_changed == 'true' || steps.changes_to_nodejs_12.outputs.any_deleted == 'true' }}
      nodejs_14_changed: ${{ steps.changes_to_nodejs_14.outputs.any_changed == 'true' || steps.changes_to_nodejs_14.outputs.any_deleted == 'true' }}
      nodejs_16_changed: ${{ steps.changes_to_nodejs_16.outputs.any_changed == 'true' || steps.changes_to_nodejs_16.outputs.any_deleted == 'true' }}
      nodejs_12_and_vscode_changed: ${{ steps.changes_to_nodejs_12_and_vscode.outputs.any_changed == 'true' || steps.changes_to_nodejs_12_and_vscode.outputs.any_deleted == 'true' }}
      nodejs_14_and_vscode_changed: ${{ steps.changes_to_nodejs_14_and_vscode.outputs.any_changed == 'true' || steps.changes_to_nodejs_14_and_vscode.outputs.any_deleted == 'true' }}
      nodejs_16_and_vscode_changed: ${{ steps.changes_to_nodejs_16_and_vscode.outputs.any_changed == 'true' || steps.changes_to_nodejs_16_and_vscode.outputs.any_deleted == 'true' }}
      nodejs_12_and_webstorm_changed: ${{ steps.changes_to_nodejs_12_and_webstorm.outputs.any_changed == 'true' || steps.changes_to_nodejs_12_and_webstorm.outputs.any_deleted == 'true' }}
      nodejs_14_and_webstorm_changed: ${{ steps.changes_to_nodejs_14_and_webstorm.outputs.any_changed == 'true' || steps.changes_to_nodejs_14_and_webstorm.outputs.any_deleted == 'true' }}
      nodejs_16_and_webstorm_changed: ${{ steps.changes_to_nodejs_16_and_webstorm.outputs.any_changed == 'true' || steps.changes_to_nodejs_16_and_webstorm.outputs.any_deleted == 'true' }}
      openjdk_8_changed: ${{ steps.changes_to_openjdk_8.outputs.any_changed == 'true' || steps.changes_to_openjdk_8.outputs.any_deleted == 'true' }}
      openjdk_11_changed: ${{ steps.changes_to_openjdk_11.outputs.any_changed == 'true' || steps.changes_to_openjdk_11.outputs.any_deleted == 'true' }}
      openjdk_8_and_eclipse_changed: ${{ steps.changes_to_openjdk_8_and_eclipse.outputs.any_changed == 'true' || steps.changes_to_openjdk_8_and_eclipse.outputs.any_deleted == 'true' }}
      openjdk_11_and_eclipse_changed: ${{ steps.changes_to_openjdk_11_and_eclipse.outputs.any_changed == 'true' || steps.changes_to_openjdk_11_and_eclipse.outputs.any_deleted == 'true' }}
      pycharm_changed: ${{ steps.changes_to_pycharm.outputs.any_changed == 'true' || steps.changes_to_pycharm.outputs.any_deleted == 'true' }}
      python_2-7_changed: ${{ steps.changes_to_python_2-7.outputs.any_changed == 'true' || steps.changes_to_python_2-7.outputs.any_deleted == 'true' }}
      python_3-9_changed: ${{ steps.changes_to_python_3-9.outputs.any_changed == 'true' || steps.changes_to_python_3-9.outputs.any_deleted == 'true' }}
      python_3-10_changed: ${{ steps.changes_to_python_3-10.outputs.any_changed == 'true' || steps.changes_to_python_3-10.outputs.any_deleted == 'true' }}
      python_2-7_and_pycharm_changed: ${{ steps.changes_to_python_2-7_and_pycharm.outputs.any_changed == 'true' || steps.changes_to_python_2-7_and_pycharm.outputs.any_deleted == 'true' }}
      python_3-9_and_pycharm_changed: ${{ steps.changes_to_python_3-9_and_pycharm.outputs.any_changed == 'true' || steps.changes_to_python_3-9_and_pycharm.outputs.any_deleted == 'true' }}
      python_3-10_and_pycharm_changed: ${{ steps.changes_to_python_3-10_and_pycharm.outputs.any_changed == 'true' || steps.changes_to_python_3-10_and_pycharm.outputs.any_deleted == 'true' }}
      python_2-7_and_vscode_changed: ${{ steps.changes_to_python_2-7_and_vscode.outputs.any_changed == 'true' || steps.changes_to_python_2-7_and_vscode.outputs.any_deleted == 'true' }}
      python_3-9_and_vscode_changed: ${{ steps.changes_to_python_3-9_and_vscode.outputs.any_changed == 'true' || steps.changes_to_python_3-9_and_vscode.outputs.any_deleted == 'true' }}
      python_3-10_and_vscode_changed: ${{ steps.changes_to_python_3-10_and_vscode.outputs.any_changed == 'true' || steps.changes_to_python_3-10_and_vscode.outputs.any_deleted == 'true' }}
      vscode_changed: ${{ steps.changes_to_vscode.outputs.any_changed == 'true' || steps.changes_to_vscode.outputs.any_deleted == 'true' }}
      webstorm_changed: ${{ steps.changes_to_webstorm.outputs.any_changed == 'true' || steps.changes_to_webstorm.outputs.any_deleted == 'true' }}
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 2 # This is for changed-files.
    - id: changes_to_eclipse
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          ides/eclipse/configure_eclipse_to_autostart.sh
          ides/eclipse/create_eclipse_desktop_shortcut.sh
          ides/eclipse/Dockerfile
          ides/eclipse/Eclipse.desktop
          ides/eclipse/install_eclipse.sh
    - id: changes_to_nodejs_12
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          runtimes/nodejs/install_nodejs_12_on_ubuntu_focal.sh
          runtimes/nodejs/nodejs_12_on_ubuntu_focal.Dockerfile
    - id: changes_to_nodejs_14
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          runtimes/nodejs/install_nodejs_14_on_ubuntu_focal.sh
          runtimes/nodejs/nodejs_14_on_ubuntu_focal.Dockerfile
    - id: changes_to_nodejs_16
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          runtimes/nodejs/install_nodejs_16_on_ubuntu_focal.sh
          runtimes/nodejs/nodejs_16_on_ubuntu_focal.Dockerfile
    - id: changes_to_nodejs_12_and_vscode
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/nodejs-and-vscode/nodejs_12_and_vscode_on_ubuntu_focal.Dockerfile
          ides/vscode/configure_vscode_to_autostart.sh
          runtimes/nodejs/install_nodejs_12_on_ubuntu_focal.sh
    - id: changes_to_nodejs_14_and_vscode
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/nodejs-and-vscode/nodejs_14_and_vscode_on_ubuntu_focal.Dockerfile
          ides/vscode/configure_vscode_to_autostart.sh
          runtimes/nodejs/install_nodejs_14_on_ubuntu_focal.sh
    - id: changes_to_nodejs_16_and_vscode
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/nodejs-and-vscode/nodejs_16_and_vscode_on_ubuntu_focal.Dockerfile
          ides/vscode/configure_vscode_to_autostart.sh
          runtimes/nodejs/install_nodejs_16_on_ubuntu_focal.sh
    - id: changes_to_nodejs_12_and_webstorm
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/nodejs-and-webstorm/nodejs_12_and_webstorm_on_ubuntu_focal.Dockerfile
          ides/webstorm/configure_webstorm_to_autostart.sh
          runtimes/nodejs/install_nodejs_12_on_ubuntu_focal.sh
    - id: changes_to_nodejs_14_and_webstorm
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/nodejs-and-webstorm/nodejs_14_and_webstorm_on_ubuntu_focal.Dockerfile
          ides/webstorm/configure_webstorm_to_autostart.sh
          runtimes/nodejs/install_nodejs_14_on_ubuntu_focal.sh
    - id: changes_to_nodejs_16_and_webstorm
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/nodejs-and-webstorm/nodejs_16_and_webstorm_on_ubuntu_focal.Dockerfile
          ides/webstorm/configure_webstorm_to_autostart.sh
          runtimes/nodejs/install_nodejs_16_on_ubuntu_focal.sh
    - id: changes_to_openjdk_8
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          runtimes/openjdk/install_openjdk_8.sh
          runtimes/openjdk/openjdk_8_on_ubuntu_focal.Dockerfile
    - id: changes_to_openjdk_11
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          runtimes/openjdk/install_openjdk_11.sh
          runtimes/openjdk/openjdk_11_on_ubuntu_focal.Dockerfile
    - id: changes_to_openjdk_8_and_eclipse
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/openjdk-and-eclipse/openjdk_8_and_eclipse_on_ubuntu_focal.Dockerfile
          ides/eclipse/configure_eclipse_to_autostart.sh
          ides/eclipse/create_eclipse_desktop_shortcut.sh
          ides/eclipse/Eclipse.desktop
          ides/eclipse/install_eclipse.sh
          runtimes/openjdk/install_openjdk_8.sh
    - id: changes_to_openjdk_11_and_eclipse
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/openjdk-and-eclipse/openjdk_11_and_eclipse_on_ubuntu_focal.Dockerfile
          ides/eclipse/configure_eclipse_to_autostart.sh
          ides/eclipse/create_eclipse_desktop_shortcut.sh
          ides/eclipse/Eclipse.desktop
          ides/eclipse/install_eclipse.sh
          runtimes/openjdk/install_openjdk_11.sh
    - id: changes_to_pycharm
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          ides/pycharm/configure_pycharm_to_autostart.sh
          ides/pycharm/create_pycharm_desktop_shortcut.sh
          ides/pycharm/Dockerfile
          ides/pycharm/install_pycharm.sh
          ides/pycharm/jetbrains-pycharm-ce.desktop
    - id: changes_to_python_2-7
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          runtimes/python/install_python_2-7_on_ubuntu_focal.sh
          runtimes/python/python_2-7_on_ubuntu_focal.Dockerfile
    - id: changes_to_python_3-9
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          runtimes/python/install_python_3-9_on_ubuntu_focal.sh
          runtimes/python/python_3-9_on_ubuntu_focal.Dockerfile
    - id: changes_to_python_3-10
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          runtimes/python/install_python_3-10_on_ubuntu_focal.sh
          runtimes/python/python_3-10_on_ubuntu_focal.Dockerfile
    - id: changes_to_python_2-7_and_pycharm
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/python-and-pycharm/python_2-7_and_pycharm_on_ubuntu_focal.Dockerfile
          ides/pycharm/configure_pycharm_to_autostart.sh
          ides/pycharm/create_pycharm_desktop_shortcut.sh
          ides/pycharm/install_pycharm.sh
          ides/pycharm/jetbrains-pycharm-ce.desktop
          runtimes/python/install_python_2-7_on_ubuntu_focal.sh
    - id: changes_to_python_3-9_and_pycharm
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/python-and-pycharm/python_3-9_and_pycharm_on_ubuntu_focal.Dockerfile
          ides/pycharm/configure_pycharm_to_autostart.sh
          ides/pycharm/create_pycharm_desktop_shortcut.sh
          ides/pycharm/install_pycharm.sh
          ides/pycharm/jetbrains-pycharm-ce.desktop
          runtimes/python/install_python_3-9_on_ubuntu_focal.sh
    - id: changes_to_python_3-10_and_pycharm
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/python-and-pycharm/python_3-10_and_pycharm_on_ubuntu_focal.Dockerfile
          ides/pycharm/configure_pycharm_to_autostart.sh
          ides/pycharm/create_pycharm_desktop_shortcut.sh
          ides/pycharm/install_pycharm.sh
          ides/pycharm/jetbrains-pycharm-ce.desktop
          runtimes/python/install_python_3-10_on_ubuntu_focal.sh
    - id: changes_to_python_2-7_and_vscode
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/python-and-vscode/python_2-7_and_vscode_on_ubuntu_focal.Dockerfile
          ides/vscode/configure_vscode_to_autostart.sh
          runtimes/python/install_python_2-7_on_ubuntu_focal.sh
    - id: changes_to_python_3-9_and_vscode
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/python-and-vscode/python_3-9_and_vscode_on_ubuntu_focal.Dockerfile
          ides/vscode/configure_vscode_to_autostart.sh
          runtimes/python/install_python_3-9_on_ubuntu_focal.sh
    - id: changes_to_python_3-10_and_vscode
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          complete-setups/python-and-vscode/python_3-10_and_vscode_on_ubuntu_focal.Dockerfile
          ides/vscode/configure_vscode_to_autostart.sh
          runtimes/python/install_python_3-10_on_ubuntu_focal.sh
    - id: changes_to_vscode
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          ides/vscode/configure_vscode_to_autostart.sh
          ides/vscode/Dockerfile
    - id: changes_to_webstorm
      uses: tj-actions/changed-files@v1.1.2
      with:
        files: |
          .github/workflows/build_and_publish_changed_images.yaml
          ides/webstorm/configure_webstorm_to_autostart.sh
          ides/webstorm/create_webstorm_desktop_shortcut.sh
          ides/webstorm/Dockerfile
          ides/webstorm/install.sh
          ides/webstorm/WebStorm.desktop

  build_and_publish_eclipse:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.eclipse_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: ides/eclipse/Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-eclipse:20.04
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-eclipse:focal

  build_and_publish_nodejs_12:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_12_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/nodejs/nodejs_12_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs:20.04-12
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs:focal-12

  build_and_publish_nodejs_14:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_14_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/nodejs/nodejs_14_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs:20.04-14
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs:focal-14

  build_and_publish_nodejs_16:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_16_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/nodejs/nodejs_16_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs:20.04-16
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs:focal-16

  build_and_publish_nodejs_12_and_vscode:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_12_and_vscode_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/nodejs-and-vscode/nodejs_12_and_vscode_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-vscode:20.04-12
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-vscode:focal-12

  build_and_publish_nodejs_14_and_vscode:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_14_and_vscode_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/nodejs-and-vscode/nodejs_14_and_vscode_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-vscode:20.04-14
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-vscode:focal-14

  build_and_publish_nodejs_16_and_vscode:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_16_and_vscode_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/nodejs-and-vscode/nodejs_16_and_vscode_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-vscode:20.04-16
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-vscode:focal-16

  build_and_publish_nodejs_12_and_webstorm:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_12_and_webstorm_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/nodejs-and-webstorm/nodejs_12_and_webstorm_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-webstorm:20.04-12
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-webstorm:focal-12

  build_and_publish_nodejs_14_and_webstorm:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_14_and_webstorm_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/nodejs-and-webstorm/nodejs_14_and_webstorm_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-webstorm:20.04-14
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-webstorm:focal-14

  build_and_publish_nodejs_16_and_webstorm:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.nodejs_16_and_webstorm_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/nodejs-and-webstorm/nodejs_16_and_webstorm_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-webstorm:20.04-16
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-nodejs-webstorm:focal-16

  build_and_publish_openjdk_8:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.openjdk_8_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/openjdk/openjdk_8_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-openjdk:20.04-8
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-openjdk:focal-8

  build_and_publish_openjdk_11:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.openjdk_11_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/openjdk/openjdk_11_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-openjdk:20.04-11
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-openjdk:focal-11

  build_and_publish_openjdk_8_and_eclipse:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.openjdk_8_and_eclipse_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/openjdk/openjdk_8_and_eclipse_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-openjdk-eclipse:20.04-8
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-openjdk-eclipse:focal-8

  build_and_publish_openjdk_11_and_eclipse:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.openjdk_11_and_eclipse_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/openjdk/openjdk_11_and_eclipse_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-openjdk-eclipse:20.04-11
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-openjdk-eclipse:focal-11

  build_and_publish_pycharm:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.pycharm_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: ides/pycharm/Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:20.04-2.7
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:focal-2.7

  build_and_publish_python_2-7:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_2-7_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/python/python_2-7_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python:20.04-2.7
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python:focal-2.7

  build_and_publish_python_3-9:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_3-9_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/python/python_3-9_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python:20.04-3.9
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python:focal-3.9

  build_and_publish_python_3-10:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_3-10_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: runtimes/python/python_3-10_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python:20.04-3.10
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python:focal-3.10

  build_and_publish_python_2-7_and_pycharm:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_2-7_and_pycharm_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/python-and-pycharm/python_2-7_and_pycharm_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:20.04-2.7
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:focal-2.7

  build_and_publish_python_3-9_and_pycharm:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_3-9_and_pycharm_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/python-and-pycharm/python_3-9_and_pycharm_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:20.04-3.9
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:focal-3.9

  build_and_publish_python_3-10_and_pycharm:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_3-10_and_pycharm_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/python-and-pycharm/python_3-10_and_pycharm_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:20.04-3.10
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:focal-3.10

  build_and_publish_python_2-7_and_vscode:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_2-7_and_vscode_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/python-and-vscode/python_2-7_and_vscode_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-vscode:20.04-2.7
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-vscode:focal-2.7

  build_and_publish_python_3-9_and_vscode:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_3-9_and_vscode_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/python-and-vscode/python_3-9_and_vscode_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-vscode:20.04-3.9
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-vscode:focal-3.9

  build_and_publish_python_3-10_and_vscode:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.python_3-10_and_vscode_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: complete-setups/python-and-vscode/python_3-10_and_vscode_on_ubuntu_focal.Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:20.04-3.10
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-python-pycharm:focal-3.10

  build_and_publish_vscode:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.vscode_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: ides/vscode/Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-vscode:20.04
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-vscode:focal

  build_and_publish_webstorm:
    needs: detect_image_source_changes
    if: ${{ needs.detect_image_source_changes.outputs.webstorm_changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build-and-publish-image
      with:
        dockerfile_path: ides/webstorm/Dockerfile
        github_personal_access_token: ${{ secrets.GITHUB_TOKEN }}
        github_username: ${{ github.actor }}
        image_tag_1: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-webstorm:20.04
        image_tag_2: ghcr.io/itopia-inc/spaces-images/spaces-ubuntu-webstorm:focal
